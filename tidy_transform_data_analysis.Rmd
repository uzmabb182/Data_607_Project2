---
title: "Data 607-Tidying and Tranformation Data"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

Loading Libraries:

```{r}
library(tidyverse)
library(tidyr)
library(dplyr)

```


```{r}
# Get working directory path
path <- getwd()

path
```

```{r}

setwd("C:/Users/Uzma/CUNY_SPS_PROJECTS/Data_607_Project2")

```


```{r}
library(readr)

dataset1 <- read_csv("C:/Users/Uzma/CUNY_SPS_PROJECTS/Data_607_Project2/census_us_county_data.csv")

```

```{r}
dataset2 <- read_csv("C:/Users/Uzma/CUNY_SPS_PROJECTS/Data_607_Project2/ers_usda_education_data.csv")
```

```{r}
dataset3 <- read_csv("C:/Users/Uzma/CUNY_SPS_PROJECTS/Data_607_Project2/county_fips_data.csv")
```
# Cleaning/Transforming census_us_county_data, dataset2:
```{r}
head(dataset1)
```

# Make the column names lowercase

```{r}
names(dataset1) <- tolower(names(dataset1))    # Convert colnames to lower case
dataset1  
```
# Seperating a column into two columns dataset1

```{r}
dataset1 <- dataset1 %>% separate(name, c("county", "state"), ",")

dataset1
```

# Dropping duplicates
```{r}
dataset1 <- dataset1 %>% distinct()

dataset1
```

# Renaming the columns
```{r}
names(dataset1)[4:9] <- c('median_age', 'household_income', 'per_capita_income', 'poverty_count',
                     'poverty_rate', 'unemployment_rate')

dataset1
```

# Removing the string 'county'
```{r}
dataset1$county <-gsub(" County","",as.character(dataset1$county))

dataset1
```

```{r}
glimpse(dataset1)
```

```{r}
str(dataset1)
```

```{r}
dataset1$state <- trimws(dataset1$state, which = c("left"))

str(dataset1)

```
# Sorting by columns
```{r}
# sort by state and county
# sort the dataframe in R using arrange

dataset1 <- arrange(dataset1,state, county)

dataset1
```
# fill NA with 0 in dataset1
```{r}
dataset1[is.na(dataset1)] <- 0

dataset1
```

# Analysis:
# Step 1: Select data frame
# Step 2: Group data
# Step 3: Summarize the data
# Step 4: Plot the summary statistics
```{r}
library(ggplot2)
# Step 1
dataset1 %>% 
#Step 2
group_by(state) 


```
# Multiple columns data by bar plot:
```{r}
# First filter the state Alabama and selecting the columns 

dataset1_alabama <- dataset1 %>% filter(state == "Alabama") %>%

  select(c(3:9, 1))

dataset1_alabama
```
```{r}
str(dataset1_alabama)
```


# Transform the table from wide form to long form
```{r}
data1_al <- dataset1_alabama %>%

  pivot_longer(cols = c(2:8),

               names_to = "Variable",

               values_to = "Value")

data1_al
```

```{r}
bar_plot <- ggplot(data = data1_al, aes(x = Variable, y = Value, fill = Variable)) +

  geom_bar(stat = "identity") + coord_flip() +
  
  labs(
        x = "Variables",
        y = "Values",
        title = paste(
            "Census data for Alabama"
        )
)
bar_plot

```
# Cleaning/Transforming ers_usda_education_data, dataset2:
```{r}
head(dataset2)
```
```{r}
colnames(dataset2)
```


# Dropping 4:32 columns
```{r}

dataset2 <- select(dataset2, -(4:32))
                           

dataset2
```
# Rename the columns by removing space with underscore
```{r}
names(dataset2) <- gsub(" ", "_", names(dataset2))

dataset2
```
# Removing  comma from column names
```{r}
names(dataset2) <- gsub(",", "", names(dataset2))

dataset2
```
# Removing  apostrophy from column names
```{r}
names(dataset2) <- gsub("'", "", names(dataset2))

dataset2
```
```{r}
names(dataset2) <- gsub("-", "_", names(dataset2))

dataset2
```


# Making column names to lowercase
```{r}
names(dataset2) <- tolower(names(dataset2))    # Convert colnames to lower case
dataset2
```

# Removing the string  'county' from 'area_name'
```{r}
dataset2$area_name <-gsub(" County","",as.character(dataset2$area_name))

dataset2
```
# Dropping the duplicate rows
```{r}
dataset2 <- dataset2 %>% distinct()

dataset2
```
# Drop first row
```{r}
dataset2 <- dataset2[-c(seq(1, 1, by=0)),]

dataset2
```
# fill NA with 0 in dataset3
```{r}
dataset2[is.na(dataset2)] <- 0

dataset2
```

```{r}
names(dataset2)[3] <- c('county')

dataset2
```

```{r}
# sort by state and county
# sort the dataframe in R using arrange

dataset2 <- arrange(dataset2,state, county)

dataset2
```
```{r}
glimpse(dataset2)
```

# Analysis:
# Multiple columns data by bar plot:
```{r}
# First filter the state Alabama and selecting the columns 

dataset2_alabama <- dataset2 %>% filter(county == "Alabama") %>%

  select(c(3, 4, 5, 6, 7, 8, 9, 10))

dataset2_alabama

```

# Transform the table from wide form to long form
```{r}
data2_al <- dataset2_alabama %>%

  pivot_longer(cols = c(2:8),

               names_to = "Variable",

               values_to = "Value")

data2_al

```

```{r}


p <- ggplot(data = data2_al, aes(x = Variable, y = Value)) +

  geom_bar(stat = "identity") + coord_flip()

p
```

# Tidying/Transforming dataset3
```{r}
# Now tidying dataset3

head(dataset3)
```

# Making column names lowercase
```{r}
names(dataset3) <- tolower(names(dataset3))    # Convert colnames to lower case
dataset3
```
# Removing the string 'county' from 'county_name'
```{r}
dataset3$county_name <-gsub(" County","",as.character(dataset3$county_name))

dataset3
```
# Fill NA with 0
```{r}
dataset3[is.na(dataset3)] <- 0
```


```{r}
str(dataset3)
```

```{r}
glimpse(dataset3)
```

# Checking the working directory path and exporting data frame into a CSV file
```{r}
# Get working directory path
path <- getwd()

path

```

```{r}
# Export file as csv to working directory.  

write.csv(dataset1, file.path(path, "cleaned_dataset1.csv"))
write.csv(dataset2, file.path(path, "cleaned_dataset2.csv"))
write.csv(dataset3, file.path(path, "cleaned_dataset3.csv"))

```




